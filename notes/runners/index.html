<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Leonid Gremyachikh">
    <meta name="description" content="Useful stuff for PyTorch – Catalyst and PyTorch Lightning.">
    <meta name="keywords" content="blog,developer,personal,research,researcher,machine learning,deep learning,computer vision,reinforcement learning">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PyTorch Frameworks"/>
<meta name="twitter:description" content="Useful stuff for PyTorch – Catalyst and PyTorch Lightning."/>

    <meta property="og:title" content="PyTorch Frameworks" />
<meta property="og:description" content="Useful stuff for PyTorch – Catalyst and PyTorch Lightning." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bamasa.github.io/notes/runners/" />
<meta property="article:published_time" content="2022-04-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-04-16T00:00:00+00:00" /><meta property="og:see_also" content="https://bamasa.github.io/notes/useful/" />



    <title>
  PyTorch Frameworks · Leonid Gremyachikh
</title>

    
      <link rel="canonical" href="https://bamasa.github.io/notes/runners/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.3ef54d6d0ced5b90be5efca8d3d546c7a1e833e55b95cfdfd9a2daf1170ae312.css" integrity="sha256-PvVNbQztW5C&#43;Xvyo09VGx6HoM&#43;Vblc/f2aLa8RcK4xI=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css" integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="/css/add.css" />
    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    
      <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
    

    <meta name="generator" content="Hugo 0.76.3" />
  </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=" twemoji.parse(document.body); "
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Leonid Gremyachikh
    </a>
    
      
        <span id="dark-mode-toggle" class="float-right">
          <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
        </span>
      
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/works/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/notes/">Notes</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/log/">Log</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
        
        
        
          <li class="navigation-item separator">
            <span>|</span>
          </li>
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">PyTorch Frameworks</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2022-04-16T00:00:00Z'>
                April 16, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <a href="/tags/stuff/">stuff</a></div>

        </div>
      </header>


      <div>
        
        <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h1 id="catalyst">Catalyst</h1>
<!-- raw HTML omitted -->
<h2 id="api">API</h2>
<h3 id="runner">Runner</h3>
<p><code>Runner</code> – the logic of your deep learning experiment</p>
<ul>
<li>data</li>
<li>model</li>
<li>batch handling logic</li>
<li>metrics</li>
<li>monitoring systems.</li>
</ul>
<h3 id="callback">Callback</h3>
<p>The <code>Callback</code> API repeats main for-loops in our train-loop abstraction:</p>
<ul>
<li>on experiment start/end</li>
<li>on batch start/end</li>
<li>on stage start/end</li>
<li>etc.</li>
</ul>
<h3 id="metric">Metric</h3>
<p>The <code>Metric</code> API.</p>
<h3 id="logger">Logger</h3>
<p>Logger for metrics, images, hyper-parameters, etc. Can be connected with comet-ml and tensorboard.</p>
<h3 id="engine">Engine</h3>
<p>The <code>Engine</code> sets how to run:</p>
<ul>
<li>CPUEngine</li>
<li>GPUEngine</li>
<li>DataParallelEngine</li>
<li>DistributedDataParallelEngine</li>
<li>DistributedXLAEngine</li>
</ul>
<h2 id="config-api">Config API</h2>
<p>Last but not least, Catalyst supports two advanced APIs for convenient production-friendly deep learning R&amp;D. With Config API and Hydra API the Deep Learning R&amp;D becomes fully reproducible thanks to YAML hyperparameters storage usage.</p>
<h2 id="examples">Examples</h2>
<h3 id="mnist">MNIST</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">import</span> os
<span style="color:#fff;font-weight:bold">import</span> torch
<span style="color:#fff;font-weight:bold">from</span> torch <span style="color:#fff;font-weight:bold">import</span> nn
<span style="color:#fff;font-weight:bold">from</span> torch.utils.data <span style="color:#fff;font-weight:bold">import</span> DataLoader
<span style="color:#fff;font-weight:bold">from</span> catalyst <span style="color:#fff;font-weight:bold">import</span> dl
<span style="color:#fff;font-weight:bold">from</span> catalyst.contrib.datasets <span style="color:#fff;font-weight:bold">import</span> MNIST
<span style="color:#fff;font-weight:bold">from</span> catalyst.contrib.losses <span style="color:#fff;font-weight:bold">import</span> IoULoss

model = nn.Sequential(
    nn.Conv2d(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>), nn.ReLU(),
    nn.Conv2d(<span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">3</span>, <span style="color:#ff0;font-weight:bold">1</span>, <span style="color:#ff0;font-weight:bold">1</span>), nn.Sigmoid(),
)
criterion = IoULoss()
optimizer = torch.optim.Adam(model.parameters(), lr=<span style="color:#ff0;font-weight:bold">0.02</span>)

train_data = MNIST(os.getcwd(), train=True)
valid_data = MNIST(os.getcwd(), train=False)
loaders = {
    <span style="color:#0ff;font-weight:bold">&#34;train&#34;</span>: DataLoader(train_data, batch_size=<span style="color:#ff0;font-weight:bold">32</span>),
    <span style="color:#0ff;font-weight:bold">&#34;valid&#34;</span>: DataLoader(valid_data, batch_size=<span style="color:#ff0;font-weight:bold">32</span>),
}

<span style="color:#fff;font-weight:bold">class</span> CustomRunner(dl.SupervisedRunner):
    <span style="color:#fff;font-weight:bold">def</span> handle_batch(self, batch):
        x = batch[self._input_key]
        x_noise = (x + torch.rand_like(x)).clamp_(<span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#ff0;font-weight:bold">1</span>)
        y = self.model(x_noise)
        self.batch = {
            self._input_key: x,
            self._output_key: y,
            self._target_key: x
        }




runner = CustomRunner(
    input_key=<span style="color:#0ff;font-weight:bold">&#34;features&#34;</span>,
    output_key=<span style="color:#0ff;font-weight:bold">&#34;scores&#34;</span>, 
    target_key=<span style="color:#0ff;font-weight:bold">&#34;targets&#34;</span>, 
    loss_key=<span style="color:#0ff;font-weight:bold">&#34;loss&#34;</span>
)

<span style="color:#007f7f"># model training</span>
runner.train(
    model=model,
    criterion=criterion,
    optimizer=optimizer,
    loaders=loaders,
    num_epochs=<span style="color:#ff0;font-weight:bold">1</span>,
    callbacks=[
        dl.IOUCallback(input_key=<span style="color:#0ff;font-weight:bold">&#34;scores&#34;</span>, target_key=<span style="color:#0ff;font-weight:bold">&#34;targets&#34;</span>),
        dl.DiceCallback(input_key=<span style="color:#0ff;font-weight:bold">&#34;scores&#34;</span>, target_key=<span style="color:#0ff;font-weight:bold">&#34;targets&#34;</span>),
        dl.TrevskyCallback(input_key=<span style="color:#0ff;font-weight:bold">&#34;scores&#34;</span>, target_key=<span style="color:#0ff;font-weight:bold">&#34;targets&#34;</span>, alpha=<span style="color:#ff0;font-weight:bold">0.2</span>),
    ],
    logdir=<span style="color:#0ff;font-weight:bold">&#34;./logdir&#34;</span>,
    valid_loader=<span style="color:#0ff;font-weight:bold">&#34;valid&#34;</span>,
    valid_metric=<span style="color:#0ff;font-weight:bold">&#34;loss&#34;</span>,
    minimize_valid_metric=True,
    verbose=True,
)
</code></pre></div><h1 id="useful-stuff">Useful stuff</h1>
<h3 id="runnertrain-args">runner,train args</h3>
<ul>
<li>loaders: dictionary with one or several <code>torch.utils.data.DataLoader</code> for training, validation or inference</li>
<li>model: model to train</li>
<li>engine: engine to use for model training</li>
<li>criterion: criterion function for training</li>
<li>optimizer: optimizer for training</li>
<li>scheduler: scheduler for training</li>
<li>callbacks: list or dictionary with Catalyst callbacks</li>
<li>loggers: dictionary with Catalyst loggers</li>
<li>seed: experiment&rsquo;s initial seed value</li>
<li>hparams: hyperparameters for the run</li>
<li>num_epochs: number of training epochs</li>
<li>logdir: path to output directory</li>
<li>resume: path to checkpoint for model</li>
<li>valid_loader: loader name used to calculate the metrics and save the checkpoints. For example, you can pass <code>train</code> and then the metrics will be taken from <code>train</code> loader.</li>
<li>valid_metric: the key to the name of the metric by which the checkpoints will be selected.</li>
<li>minimize_valid_metric: flag to indicate whether the <code>valid_metric</code> should be minimized or not (default: True).</li>
<li>verbose: if <code>True</code>, it displays the status of the training to the console.</li>
<li>timeit: if True, computes the execution time
of training process and displays it to the console.</li>
<li>check: if True, then only checks that pipeline is working
(3 epochs only with 3 batches per loader)</li>
<li>overfit: if True, then takes only one batch per loader
for model overfitting, for advance usage please check
<code>BatchOverfitCallback</code></li>
<li>profile: if True, then uses ProfilerCallback, for advance usage please check
<code>ProfilerCallback</code></li>
<li>load_best_on_end: if True, Runner will load
best checkpoint state (model, optimizer, etc)
according to validation metrics. Requires specified <code>logdir</code>.</li>
<li>cpu: boolean flag to force CPU usage</li>
<li>fp16: boolean flag to use half-precision</li>
<li>ddp: if <code>True</code> will start training in distributed mode.
Note: Works only with python scripts. No jupyter support.</li>
</ul>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">catalyst-dl run -C train_config.yml
</code></pre></div><h1 id="pytorch-lightning">Pytorch Lightning</h1>
<p>TODO</p>
<h1 id="links">Links</h1>
<p>Comparison: <a href="https://neptune.ai/blog/model-training-libraries-pytorch-ecosystem">8 Creators and Core Contributors Talk About Their Model Training Libraries From PyTorch Ecosystem, January 17th, 2022</a></p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in stuff</h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="/notes/useful/">DL useful stuff</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "bamasa" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    

      <section class="container centered">
      <div class="about">
        
        <ul>
          
            
              <li>
                <a href="https://t.me/bamasa" aria-label="Telegram"   >
                  <i class="fa fa-telegram" aria-hidden="true"></i>
                </a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/bamasa/" aria-label="Github"   >
                  <i class="fa fa-github" aria-hidden="true"></i>
                </a>
              </li>
            
          
            
              <li>
                <a href="https://gitlab.com/bamasa/" aria-label="Gitlab"   >
                  <i class="fa fa-gitlab" aria-hidden="true"></i>
                </a>
              </li>
            
          
            
              <li>
                <a href="mailto:lgremyachikh@gmail.com" aria-label="Email"   >
                  <i class="fa fa-envelope" aria-hidden="true"></i>
                </a>
              </li>
            
          
            
              <li>
                <a href="https://instagram.com/bamasa.lg" aria-label="Instagram" rel="alternate"  type="application/rss&#43;xml">
                  <i class="fa fa-instagram" aria-hidden="true"></i>
                </a>
              </li>
            
          
            
              <li>
                <a href="https://bamasa.github.io/files/Leonid_Gremyachikh_CV.pdf" aria-label="CV"   >
                  <i class="fa fa-address-card" aria-hidden="true"></i>
                </a>
              </li>
            
          
        </ul>
        
      </div>
    </section> 
  </section>

      </div>

      
    </main>

    
      
      <script src="/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js"></script>
    

    

    

    

    

    <script data-goatcounter="https://code.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

  </body>

</html>
